#!/usr/bin/env bash
set -euo pipefail

MODE="explain"

print_help() {
  cat <<'USAGE'
Usage:
  ask-select [options]

Options:
  --translate         Translate the selected text
  --explain           Explain the selected text (default)
  -h | --help         Show this help
USAGE
}

while [ $# -gt 0 ]; do
  case "$1" in
    --translate) MODE="translate" ;;
    --explain) MODE="explain" ;;
    -h|--help) print_help; exit 0 ;;
    *) echo "Unknown option: $1" >&2; print_help; exit 1 ;;
  esac
  shift
done

if command -v xclip >/dev/null 2>&1; then
  TEXT=$(xclip -selection primary -o 2>/dev/null || true)
elif command -v wl-paste >/dev/null 2>&1; then
  TEXT=$(wl-paste --primary 2>/dev/null || true)
else
  echo "❌ xclip or wl-paste required for selection support" >&2
  exit 1
fi

if [ -z "$TEXT" ]; then
  echo "❌ No text selected"
  exit 1
fi

ask --"$MODE" "$TEXT"
